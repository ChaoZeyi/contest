刚看到题目，比较迷茫，之前可以根据01序列来表示是否部署服务器，但现在同时还要考虑等级。最开始想的是先把等级定为最高级，再沿用初赛的方法来确定服务器的位置，然后在计算最大流函数里面，计算每个服务器实际提供的流量和它当前档位对应可提供的最大流量，如果可提供的流量大于实际提供的流量，说明可以对该点的服务器进行降档，经过调试发现，最终降档得到的服务器档位大多位于4档5档。然后我们就尝试把所有的服务器档位初始化为4档或者5档，实验结果证明这样初始化比初始全部设为最高档的效果好得多，但这样存在的问题就是这个4和5有点调参的意思，可能对于现在的练习用例是这样，如果换了一个用例可能就会差很多，而且命题组就是为了保证算法的普适性，一直在更换用例，所以我们当时的心情真的就跟过山车一样，一上一下，=_=.......当时无比吐槽，不过现在想想还是有道理的，一个算法就应该是普适的，可以用来解决这一类的问题，而不是这一个，不能用一些投机取巧的方法。

到后面，我们跟其他大佬交流，尝试使用了性价比的方法来定服务器的初始档位，性价比=（部署成本+硬件成本）/能提供的最大流量，是一种粗略计算的性价比，实验证明，这个用来定初始档位的方法很好，根据这个计算，最佳的初始档位差不多也都是4档或者5档，还有一种精确计算性价比的计算，对于单点服务器计算最大流，对每次增广的流量和花费计算性价比，并记录最佳性价比，把对应的档位作为初始档位，按理说，这样精确计算的效果应该比粗略的效果好才对，不过事实证明确实是前一种更好，所以采用的还是粗略计算的性价比。

然后就是基本的费用流问题，因为复赛相比于初赛，用例规模更大了，如果用之前的最小费用流，时间根本不够用，然后就继续优化，改为了现在的ZKW算法，相比于初赛，时间确实缩短了很多（到决赛才知道，虽然是ZKW，但速度还是被其他大佬碾压，哭......），因为又是一种完全不同、完全陌生的算法，当时做足了测试，就怕出什么bug，还好一切顺利，不过有两天被一个蜜汁bug纠缠了两天：算法中间用的费用流是ZKW，最后一次找出最优服务器序列后计算费用流用的是初赛的spfa，因为之前和写好的跟这个适配的输出路径函数，所以就偷懒没有改，但有时候费用总会差那么300、600，让我一度怀疑是我的ZKW费用流有问题，但单元测试是正常的，而且每步的整体调试也是正常的，当时内心都崩溃了，到最后最后才发现其实是因为用两种算法算费用流的时候，路径不是完全一样的，只保证了流量和花费一样，但路径怎么走，走多少并不能保证完全一样，这就有可能出现这样一种情况，比如说，档位4能提供的最大流量是200，费用是2100，档位5能提供的最大流量是250，费用是2400，当使用ZKW计算时，某个服务器实际提供的流量是198，所以最后档位应该定为4档，但最后使用spfa计算时，这个服务器实际提供的流量可能就是201了，档位应该定为5档，这就导致了费用总会有几百的差别，但这两种方法都是正确的，只能说不适配？？哈哈，反正最后把最后的spfa也换为ZKW就没有这个问题了，只是又要对应着重写一遍输出路径函数。解决了就好，反正当时是已经调试到崩溃，整整两天，搞这么一个东西，没想到最后竟然是这么一个bug。

还有就是，在复赛中起关键性作用的服务器相邻节点替换，哈哈，因为之前被我写错了一个地方，所以效果一直不明显，还好在小郭同学的监督下一步一步调试，把替换函数改好，效果简直惊人，直接就冲上了第一，哈哈，上图纪念一下，

![first.png](https://github.com/ChaoZeyi/contest/blob/master/photos/first.png?raw=true)

当时就激动了，这就说明我们的前四差不多是已经稳了，开心！这个时候的版本差不多已经是最终版了，后面还有遗传算法的一些调整，比如说种群大小，序列长度，不同等级的用例均有所不同（初级、中级、高级），就等着现场复赛了。

4月23号那天，信心满满去了武研所，以为就是去提交个代码，然后领个手机回来，谁知这种时候服务器还能挂掉，先加时到6点，然后还是不行，直接推迟两天，哎，又要多熬两天了，当时还担心会不会有什么变数，两天时间别人会不会优化把我们给超了，还好，到25号线上提交的时候，还是稳稳的第二，记得当时我们三做了三小时的解说，哪个队提交了，提交了多少次，哪个队危险了，哪个队还是很稳的，哈哈！再次恭喜一下月光大佬最后十分钟的绝地反杀，简直凶险，当然，对于三人游这个队还是很可惜的，毕竟之前很长一段时间都是我们两个队在争第一，不相上下，最后居然没进前四，可惜了。

![semi-final_result.png](https://github.com/ChaoZeyi/contest/blob/master/photos/semi-final_result.png?raw=true)

搞完复赛，实在是太累了，就趁着五一假期去西安玩了一趟，哈哈哈哈，虽然玩的开心，但还是愧对队友，可能多花这些时间，决赛结果就会好一点了呢！





